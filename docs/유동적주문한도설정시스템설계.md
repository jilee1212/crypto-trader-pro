# 유동적 주문 한도 설정 시스템 설계 ✅ 완료

> **구현 상태**: Phase 6.1-6.5 모든 단계 완료됨 (2025.09.23)

## ✅ 완료된 구현 사항

### 거래소 최소 금액 자동 조회 (Step 6.1)
- 실시간 최소 주문 금액 조회 시스템 구현 완료
- 30분 캐싱 시스템으로 API 호출 최적화
- 주요 거래쌍 최소 금액 자동 업데이트

### 사용자별 주문 한도 설정 (Step 6.2)
- Settings 페이지에 거래 설정 섹션 추가 완료
- 데이터베이스 schema 확장 (trading_settings 테이블)
- 동적 한도 검증 시스템 구현

### 스마트 주문 금액 제안 (Step 6.3)
- 추천 금액 계산 로직 구현
- 빠른 주문 버튼 시스템
- 리스크 계산기 통합

### 주문 실행 전 검증 (Step 6.4)
- 다단계 검증 프로세스 구현
- 주문 확인 시스템
- 포괄적 에러 처리

### 거래 설정 최적화 (Step 6.5)
- 프리셋 설정 (보수적/균형/적극적)
- 자동 조정 옵션
- 고급 거래 설정 UI

## 🔧 해결 방안 설계

### Phase 6.2: 유동적 주문 한도 시스템

#### 1. 거래소 최소 금액 자동 확인
```python
# 각 거래쌍별 최소 주문 금액 동적 조회
min_amounts = {
    'BTC/USDT': 10.0,
    'ETH/USDT': 10.0,
    'XRP/USDT': 8.0,
    'ADA/USDT': 5.0,
    'DOT/USDT': 5.0
}
```

#### 2. 사용자별 한도 설정
```python
# 사용자 설정 가능 범위
user_settings = {
    'min_order_amount': 거래소_최소금액,  # 동적 계산
    'max_order_amount': 사용자_설정값,   # 기본값: 50 USDT
    'default_order_amount': 사용자_설정값 # 기본값: 10 USDT
}
```

## 📋 Claude Code 구현 계획

### Step 6.1: 거래소 최소 금액 조회 시스템 (30분)

**Claude Code 요청:**
```
거래소별 최소 주문 금액을 자동으로 조회하는 시스템을 구현해주세요.

요구사항:
1. 실시간 최소 주문 금액 조회:
   - Binance API에서 심볼별 최소 주문 금액 가져오기
   - exchange_info() 또는 markets() 함수 사용
   - 주요 거래쌍 (BTC, ETH, XRP, ADA, DOT 등) 지원

2. 최소 금액 캐싱 시스템:
   - st.session_state.min_order_amounts로 저장
   - 30분마다 업데이트
   - 오프라인 시 기본값 사용

3. 코인별 최소 금액 표시:
   - 거래 인터페이스에서 "최소 주문: 8 USDT" 형태로 표시
   - 주문 금액 입력 시 실시간 검증
   - 최소 금액 미만 입력 시 경고 메시지

구현 위치:
- binance_mainnet_connector.py에 get_min_order_amounts() 메서드 추가
- main_app.py의 거래 페이지에서 호출
```

### Step 6.2: 사용자별 주문 한도 설정 UI (45분)

**Claude Code 요청:**
```
사용자가 주문 한도를 유동적으로 설정할 수 있는 인터페이스를 구현해주세요.

요구사항:
1. Settings 페이지에 거래 설정 섹션 추가:
   - "거래 한도 설정" 섹션
   - 최대 주문 금액 슬라이더 (10 USDT ~ 1000 USDT)
   - 기본 주문 금액 입력 (거래소 최소금액 ~ 최대금액 범위)
   - 설정 저장 버튼

2. 동적 한도 검증:
   - 선택한 코인의 최소 주문 금액 자동 표시
   - 설정값이 최소 금액보다 작으면 자동 조정
   - 실시간 유효성 검사

3. 거래 페이지 연동:
   - 주문 금액 입력 시 사용자 설정 한도 적용
   - 기본값을 사용자 설정 기본 주문 금액으로 설정
   - 한도 초과 시 경고 및 자동 조정

데이터베이스 저장:
- 사용자별 거래 설정을 trading_settings 테이블에 저장
- max_order_amount, default_order_amount 컬럼 추가
- 로그인 시 자동 로드
```

### Step 6.3: 스마트 주문 금액 제안 시스템 (30분)

**Claude Code 요청:**
```
코인별 최적 주문 금액을 제안하는 스마트 시스템을 구현해주세요.

요구사항:
1. 추천 금액 계산 로직:
   - 거래소 최소 금액의 1.2배를 기본 추천
   - 사용자 계좌 잔고의 1-5% 범위 내에서 제안
   - 코인별 가격 변동성을 고려한 적절한 포지션 크기

2. 빠른 주문 버튼:
   - "추천: 10 USDT", "안전: 15 USDT", "적극: 25 USDT" 버튼
   - 클릭 시 해당 금액으로 즉시 설정
   - 각 옵션별 예상 수익/손실 표시

3. 리스크 계산기:
   - 입력한 주문 금액의 리스크 레벨 표시
   - 전체 자금 대비 비율 계산
   - "이 주문은 전체 자금의 X%입니다" 안내

표시 예시:
```
XRP/USDT 거래
최소 주문: 8 USDT (거래소 기준)
추천 주문: [10 USDT] [15 USDT] [25 USDT]
현재 설정: 12 USDT (전체 자금의 2.4%)
```
```

### Step 6.4: 주문 실행 전 최종 검증 (30분)

**Claude Code 요청:**
```
주문 실행 전 모든 조건을 검증하는 시스템을 구현해주세요.

요구사항:
1. 다단계 검증 프로세스:
   - 거래소 최소 금액 확인
   - 사용자 설정 최대 한도 확인  
   - 계좌 잔고 충분성 확인
   - API 연결 상태 확인

2. 주문 확인 다이얼로그:
   - 주문 상세 정보 표시 (코인, 방향, 금액, 예상 수수료)
   - 리스크 경고 (전체 자금 대비 비율)
   - "확인" 버튼 클릭 후 실행

3. 에러 처리 및 가이드:
   - 최소 금액 미달: "XRP/USDT 최소 주문 금액은 8 USDT입니다"
   - 한도 초과: "설정한 최대 주문 금액 50 USDT를 초과했습니다"
   - 잔고 부족: "USDT 잔고가 부족합니다. 현재: 25 USDT"
   - 해결 방안 제시: "Settings에서 한도를 조정하거나 다른 코인을 선택하세요"

4. 주문 히스토리 기록:
   - 성공한 주문과 실패한 주문 모두 기록
   - 실패 사유 저장 (최소 금액, 한도 초과, 잔고 부족 등)
   - 통계 표시 (성공률, 평균 주문 금액 등)
```

### Step 6.5: 거래 설정 최적화 (30분)

**Claude Code 요청:**
```
사용자 편의성을 높이는 고급 거래 설정을 구현해주세요.

요구사항:
1. 코인별 개별 설정:
   - 각 코인마다 다른 기본 주문 금액 설정 가능
   - "XRP는 10 USDT, BTC는 50 USDT" 형태
   - 자주 거래하는 코인 즐겨찾기 설정

2. 프리셋 설정:
   - "보수적", "균형", "적극적" 프리셋 제공
   - 보수적: 최소금액 × 1.2, 최대 30 USDT
   - 균형: 최소금액 × 1.5, 최대 100 USDT  
   - 적극적: 최소금액 × 2, 최대 500 USDT

3. 자동 조정 옵션:
   - 잔고 비율 기반 자동 주문 금액 계산
   - "전체 자금의 2%로 고정" 옵션
   - 변동성 높은 날 자동으로 주문 금액 축소

4. 거래 시간 제한:
   - 특정 시간대에만 거래 허용
   - 주말 거래 금지 옵션
   - 일일 최대 거래 횟수 제한

UI 개선:
- 설정 변경 시 실시간 미리보기
- 설정 저장 시 확인 메시지
- 기본값 복원 버튼
- 설정 가져오기/내보내기 기능
```

## 🎯 예상 결과

### 사용자 경험 개선
- **맞춤형 한도**: 개인별 리스크 선호도에 맞는 설정
- **스마트 제안**: AI 기반 최적 주문 금액 추천  
- **에러 방지**: 주문 실패 사전 차단
- **편의 기능**: 빠른 주문, 프리셋 활용

### 거래 효율성 증대  
- **코인별 최적화**: 각 코인의 특성을 반영한 주문 금액
- **리스크 관리**: 전체 포트폴리오 관점의 리스크 제어
- **성공률 향상**: 사전 검증으로 주문 실패율 최소화

### 안전성 강화
- **다단계 검증**: 실행 전 모든 조건 확인
- **리스크 표시**: 주문 금액의 위험도 실시간 계산
- **자동 제한**: 과도한 거래 방지 메커니즘

## 📊 구현 우선순위

| 단계 | 예상 시간 | 중요도 | 설명 |
|------|-----------|--------|------|
| Step 6.1 | 30분 | 🔥🔥🔥🔥🔥 | 거래소 최소 금액 자동 조회 (필수) |
| Step 6.2 | 45분 | 🔥🔥🔥🔥🔥 | 사용자별 주문 한도 설정 UI (필수) |
| Step 6.3 | 30분 | 🔥🔥🔥🔥 | 스마트 주문 금액 제안 (편의성) |
| Step 6.4 | 30분 | 🔥🔥🔥🔥🔥 | 주문 실행 전 검증 (안전성) |
| Step 6.5 | 30분 | 🔥🔥🔥 | 거래 설정 최적화 (고급 기능) |

이 시스템을 구현하면 현재의 5 USDT 제한 문제를 완전히 해결하고, 각 코인의 최소 주문 금액을 자동으로 처리할 수 있습니다.